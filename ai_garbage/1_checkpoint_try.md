# 1. Выбор темы и постановка задачи

## 1.1. Тема
**Классификация эмоциональной окраски пользовательских комментариев для своевременной поддержки**

## 1.2. Формализация задачи

| Аспект | Описание |
|--------|----------|
| **Тип ML-задачи** | Бинарная классификация текста (позитивный/негативный sentiment) |
| **Объект применения** | Комментарии в социальных сетях (Reddit-подобные платформы) |
| **Контекст** | Онлайн-классификация в реальном времени |
| **Бизнес-эффект** | Автоматическое выявление пользователей с негативным эмоциональным состоянием и отправка поддерживающих сообщений |
| **Ограничения** | Время ответа ≤ 5-10 секунд, онлайн-режим, масштабируемость под нагрузку |

## 1.3. Baseline (v0)
**Правило без ML:** Все комментарии классифицируются как "грустные" → всем отправляется поддержка

**Обоснование:**
- Простота реализации
- 100% recall для негативных комментариев (не пропустим ни одного)
- Позволяет оценить precision будущей ML-модели
- Низкий риск ложноотрицательных срабатываний

---

# 2. Первичный сбор данных и EDA

## 2.1. Источники данных

### Источник 1: Reddit Sentiment Analysis Dataset
**URL:** https://www.kaggle.com/datasets/vijayj0shi/reddit-dataset-with-sentiment-analysis

| Параметр | Значение |
|----------|----------|
| **Объём** | ~100K+ комментариев |
| **Формат** | CSV |
| **Колонки** | Sentiment, Body, Post_Title, Post_ID, Author, Parent_ID, Comment_ID |
| **Классы** | Positive, Negative, Neutral |
| **Язык** | Английский |

**Преимущества:**
- Большой объём данных
- Реальные комментарии из Reddit
- Три класса sentiment для гибкости

**Недостатки:**
- Может содержать шум в разметке
- Специфичный Reddit-сленг

---

### Источник 2: Cyberbullying Classification Dataset ⭐ (рекомендуемый)
**URL:** https://www.kaggle.com/datasets/andrewmvd/cyberbullying-classification

| Параметр | Значение |
|----------|----------|
| **Объём** | 47,000+ твитов |
| **Формат** | CSV |
| **Колонки** | `tweet_text`, `cyberbullying_type` |
| **Классы** | 6 сбалансированных классов (~8000 каждого): |
| | - `no_cyberbullying` |
| | - `religion` |
| | - `race` |
| | - `ideology` |
| | - `sexual` |
| | - `other` |
| **Баланс классов** | Сбалансирован (~8000 на класс) |
| **Язык** | Английский |
| **Источник** | Formspring.me (соцсеть) |

**Преимущества:**
- ✅ Сбалансированные классы
- ✅ Более релевантная задача (детекция негативного контента)
- ✅ Качественная разметка
- ✅ Чистый формат (2 колонки)

**Недостатки:**
- Твиты короче комментариев (может отличаться стиль)
- 6 классов → требуется агрегация для бинарной задачи

**Рекомендация по агрегации:**
```
Негативный (1): religion, race, ideology, sexual, other
Позитивный/Нейтральный (0): no_cyberbullying
```

---

## 2.2. EDA Plan

### Что проверить:
1. **Распределение длин текстов** (гистограмма token counts)
2. **Баланс классов** (pie chart / bar chart)
3. **Топ частых слов** по классам (word clouds)
4. **Пропуски** (проверка null values)
5. **Дубликаты** (проверка дубликатов текстов)
6. **Языковое распределение** (detect non-English)
7. **Корреляция слов с классами** (риск ложных корреляций)

### Потенциальные утечки (Data Leakage):
| Тип утечки | Вероятность | Митигация |
|------------|-------------|-----------|
| Ложные корреляции (слова-маркеры) | Средняя | Анализ feature importance, удаление спам-токенов |
| Дубликаты в train/test | Средняя | Deduplication перед сплитом |
| Временная утечка | Низкая | Если есть timestamp — сплит по времени |

---

# 3. Data Contract

## 3.1. Схема данных (Cyberbullying Dataset)

| feature_name | dtype  | required | описание | диапазон/ограничения |
|:------------ |:------ | -------- | -------- | ------------------- |
| tweet_text   | object | True     | Текст твита/комментария | 1-500 символов, не пустой |
| cyberbullying_type | object | True | Тип кибербуллинга | {no_cyberbullying, religion, race, ideology, sexual, other} |

## 3.2. Требования к данным

| Параметр | Значение |
|----------|----------|
| **Допустимая доля пропусков** | 0% (оба поля required) |
| **Допустимая доля дубликатов** | < 5% |
| **Требования к свежести** | Не критично (язык стабилен) |
| **Периодичность обновления** | Единоразово для обучения |
| **Мин. длина текста** | 1 токен |
| **Макс. длина текста** | 512 токенов (для моделей) |

---

# 4. Архитектура системы

## 4.1. High-Level Diagram

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   Пользователь  │────▶│  API Gateway     │────▶│  Sentiment      │
│   (комментарий) │     │  (FastAPI)       │     │  Classifier     │
└─────────────────┘     └──────────────────┘     │  (ML Model)     │
                                                 └────────┬────────┘
┌─────────────────┐     ┌──────────────────┐            │
│   Support       │◀────│  Message         │◀───────────┘
│   Message DB    │     │  Dispatcher      │
└─────────────────┘     └──────────────────┘
```

## 4.2. Компоненты

| Компонент | Технология | Назначение |
|-----------|------------|------------|
| **API Gateway** | FastAPI | Приём комментариев, валидация |
| **ML Model** | Scikit-learn / Transformers | Классификация sentiment |
| **Message Dispatcher** | Python + SMTP/API | Отправка сообщений поддержки |
| **Queue** (опционально) | Redis/Celery | Асинхронная обработка при нагрузке |
| **Support DB** | SQLite/PostgreSQL | Хранение шаблонов сообщений |

## 4.3. ML Pipeline

```
1. Загрузка данных → 2. Препроцессинг → 3. Feature Extraction → 4. Модель → 5. Валидация
```

---

# 5. Риски (v0)

| # | Риск | Причина | Последствие | Митигация |
|---|------|---------|-------------|-----------|
| 1 | **Сленг и неформальная лексика** | Специфика соцсетей | Снижение accuracy модели | Data augmentation, использование transformer-моделей |
| 2 | **Другой язык (не English)** | Глобальная аудитория | Невозможность классификации | Языковой детектор + фильтр на входе |
| 3 | **Большой поток комментариев** | Пиковая нагрузка | Перегруз сервиса, latency > 10s | Очереди (Redis), rate limiting, масштабирование |
| 4 | **Злоупотребление сервисом** | Спам-атаки | Перегруз, ложные срабатывания | Rate limit per user, CAPTCHA |
| 5 | **Ложные корреляции** | Слова-маркеры в данных | Модель учится на шумах | Анализ feature importance, кросс-валидация |
| 6 | **Дрейф данных** | Изменение языка со временем | Деградация качества | Мониторинг распределений, план переобучения |
| 7 | **Сарказм и контекст** | Ограничения NLP | Ложная классификация | Принять как ограничение v1, сбор фидбека |
